From 46169c5395e1ea51ee27b5647d8debc0e5ccccb6 Mon Sep 17 00:00:00 2001
From: Blake W. Ford <blake@thermasol.com>
Date: Wed, 12 Aug 2020 12:00:59 -0700
Subject: [PATCH] imx8mm_var_som: Changes required to compile Android 10 for ThermaTouch.

---
 common/build/Makefile            | 9 ++++++---
 common/imx_path/ImxPathConfig.mk | 2 ++
 common/tools/imx-make.sh         | 4 ++--
 3 files changed, 10 insertions(+), 5 deletions(-)

diff --git a/common/build/Makefile b/common/build/Makefile
index 5cf9b6b2..7142865e 100644
--- a/common/build/Makefile
+++ b/common/build/Makefile
@@ -23,13 +23,16 @@ HOST_PREBUILT_TAG := $(HOST_OS)-${HOST_PREBUILT_ARCH}
 
 # firstly to include UbootKernelCommonConfig.mk, then SharedBoardConfig.mk, finally UbootKernelBoardConfig.mk
 
-include ${fsl_git_path}/common/imx_path/ImxPathConfig.mk
+-include ${fsl_git_path}/../fsl/common/imx_path/ImxPathConfig.mk
+include ${fsl_git_path}/common/VarPathConfig.mk
 include ${soc_path}/UbootKernelCommonConfig.mk
 include ${product_path}/SharedBoardConfig.mk
 include ${product_path}/UbootKernelBoardConfig.mk
 
-include ${fsl_git_path}/common/build/kernel.mk
-include ${fsl_git_path}/common/build/uboot.mk
+-include ${fsl_git_path}/../fsl/common/build/kernel.mk
+-include ${fsl_git_path}/../fsl/common/build/uboot.mk
+include ${fsl_git_path}/../fsl/common/build/kernel.mk
+include ${fsl_git_path}/../fsl/common/build/uboot.mk
 -include ${product_path}/AndroidUboot.mk
 -include ${product_path}/AndroidTee.mk
 
diff --git a/imx8m/BoardConfigCommon.mk b/imx8m/BoardConfigCommon.mk
index 5fedf99b..2630feb0 100644
--- a/imx8m/BoardConfigCommon.mk
+++ b/imx8m/BoardConfigCommon.mk
@@ -119,7 +119,8 @@ BOARD_BOOTIMAGE_PARTITION_SIZE := 50331648
 ifeq ($(IMX_NO_PRODUCT_PARTITION),true)
 BOARD_SYSTEMIMAGE_PARTITION_SIZE := 2952790016
 else
-BOARD_SYSTEMIMAGE_PARTITION_SIZE := 1610612736
+# Updated for ThermaSol videos
+BOARD_SYSTEMIMAGE_PARTITION_SIZE := 1805307904
 endif

 BOARD_VENDORIMAGE_PARTITION_SIZE := 536870912
diff --git a/common/imx_path/ImxPathConfig.mk b/common/imx_path/ImxPathConfig.mk
index e0693010..0d3a4adf 100644
--- a/common/imx_path/ImxPathConfig.mk
+++ b/common/imx_path/ImxPathConfig.mk
@@ -21,6 +21,8 @@ IMX_SECURITY_PATH := vendor/nxp-private/security
 
 KERNEL_IMX_PATH := vendor/nxp-opensource
 UBOOT_IMX_PATH := vendor/nxp-opensource
+#KERNEL_IMX_PATH := vendor/variscite
+#UBOOT_IMX_PATH := vendor/variscite
 IMX_LIB_PATH := vendor/nxp-opensource
 IMX_MKIMAGE_PATH := vendor/nxp-opensource
 IMX_PATH := vendor/nxp-opensource
diff --git a/common/tools/imx-make.sh b/common/tools/imx-make.sh
index ebd8a2e1..47fe9f9b 100755
--- a/common/tools/imx-make.sh
+++ b/common/tools/imx-make.sh
@@ -103,7 +103,7 @@ if [ ${build_bootloader_kernel_flag} -eq 0 ] && [ ${build_android_flag} -eq 0 ];
     build_android_flag=1
 fi
 
-product_makefile=`pwd`/`find device/fsl -maxdepth 4 -name "${TARGET_PRODUCT}.mk"`;
+product_makefile=`pwd`/`find device/variscite -maxdepth 4 -name "${TARGET_PRODUCT}.mk"`;
 product_path=${product_makefile%/*}
 soc_path=${product_path%/*}
 fsl_git_path=${soc_path%/*}
@@ -115,7 +115,7 @@ fi
 
 # redirect standard input to /dev/null to avoid manually input in kernel configuration stage
 soc_path=${soc_path} product_path=${product_path} fsl_git_path=${fsl_git_path} clean_build=${clean_build} \
-    make -C ./ -f ${fsl_git_path}/common/build/Makefile ${parallel_option} \
+    make -C ./ -f ${fsl_git_path}/../fsl/common/build/Makefile ${parallel_option}  \
     ${build_bootloader} ${build_kernel} </dev/null || exit
 
 if [ ${build_android_flag} -eq 1 ]; then
-- 
2.25.0

